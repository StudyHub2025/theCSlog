# 불변 객체

---

## 1. 기본형과 참조형

### 기본형 (Primitive Type)
- 값 자체를 복사 (공유되지 않음)
- `int a = 10; int b = a;` → `a`, `b`는 독립된 값

### 참조형 (Reference Type)
- 참조값을 복사 → **객체 공유**
- 사이드 이펙트 발생 가능성 존재

```java
Address a = new Address("서울");
Address b = a;
b.setValue("부산");
```

---

## 2. 사이드 이펙트 (Side Effect)
- 객체 공유로 인한 의도치 않은 값 변경
- 예: `b`를 수정했는데 `a`도 바뀜

```java
Address a = new Address("서울");
Address b = new Address("서울");
```

---

## 3. 불변 객체 개념
- 상태 변경이 불가능한 객체
- 필드는 `private final`, setter 없음
- 생성자로만 값 설정 가능

```java
public class ImmutableAddress {
    private final String value;
    public ImmutableAddress(String value) {
        this.value = value;
    }
    public String getValue() {
        return value;
    }
}
```

---

## 4. 값 변경이 필요한 경우

- 기존 객체를 변경하지 않고 **새 객체 반환**

```java
public ImmutableObj add(int value) {
    return new ImmutableObj(this.value + value);
}
```

```java
ImmutableObj obj1 = new ImmutableObj(10);
ImmutableObj obj2 = obj1.add(20);
```

---

## 5. 회원 주소 예제

### 가변 객체 사용 시

```java
memberB.getAddress().setValue("부산"); // memberA도 영향을 받음
```

### 불변 객체 사용 시

```java
memberB.setAddress(new ImmutableAddress("부산")); // 안전
```

---

## 6. 실습 예제 - 불변 날짜 클래스

### 문제:
- `MyDate`는 가변 → 사이드 이펙트 발생

### 해결:
- `ImmutableMyDate`로 변경
- `withYear`, `withMonth` 등 메서드로 새 객체 생성

```java
public ImmutableMyDate withYear(int newYear) {
    return new ImmutableMyDate(newYear, this.month, this.day);
}
```

---

## 정리

| 항목 | 가변 객체 | 불변 객체            |
|------|-----------|------------------|
| 값 변경 | O | X                |
| 안전성 | 낮음 | 높음               |
| 객체 공유 | 위험 | 안전               |
| 사용 사례 | 일반 도메인 | DTO, 멀티스레드, 값 타입 |

- Java에서 `String`, `Integer`, `LocalDate` 등은 모두 불변 객체
- 불변 객체는 **사이드 이펙트를 원천 차단**
- 꼭 필요한 경우에만 사용 (성능 고려)

---

> 불변이라는 제약으로 사이드 이펙트를 예방할 수 있다.
