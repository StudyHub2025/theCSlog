# 네트워크

## Ch 5. 응용 계층

### DNS

- ROOT 네임 서버
- TLD 서버
- 서브 도메인 : 상위 도메인의 일부로 구성된 하위 도메인
- Authoritative DNS 서버(책임 DNS 서버) : 최종적으로 도메인의 IP 주소 정보를 저장하고 있는 서버
- Local DNS 서버(DNS Resolver): 클라이언트가 최초로 조회 요청을 보내는 DNS 서버


Public DNS : local DNS 서버 주소 명시적 설정
ISP : ~ 자동 설정

- DNS 레코드 타입
  - A 레코드 : 도메인에 대한 IPv4 주소
  - AAAA 레코드 : 도메인에 대한 IPv6 주소
  - CNAME 레코드 : 도메인에 대한 별칭
  - NS 레코드 : 네임 서버 주소
  - SOA 레코드 : 도메인에 대한 관리자 정보

- DNS 캐시 : TTL 기간동안 DNS 저장

### 자원과 자원의 식별

- URI의 분류
URL : 위치 기반 자원 식별 (Locator)
URI : 이름 기반 자원 식별 (Name)

- URL 구성 요소
  - scheme : 일반적으로 프로토콜 이름
  - authority = [userinfo "@"] host [":" port]
      - 사용자 인증을 이용한 인증 가능(선택)
      - 호스트 이름(도메인 이름 or IP 주소)
      - 포트 번호(선택)
  - path : 자원의 경로
  - query : key=value 형식의 파라미터(?로 시작, &(;)로 다수의 query 구분)
  - fragment : 특정위치를 가리키는 데 사용(#) 

  ### 웹 서버와 웹 어플리케이션 서버
  server : 대답하는 대상(responese)
  client : 요청하는 대상(request)

  server
  - 웹 서버 : 정적 자원
  - WAS (웹 어플리케이션 서버) : 동적 자원

  서버가 응답해야하는 자원
  - 정적인 자원 : 언제/어디서/누가 봐도 변하지 않는 정보 (ex. HTML, 이미지, 동영상 등)
  - 동적인 자원 : 사용자 요청/상황에 따라 변하는 정보(데이터베이스)

  ### HTTP의 특성
 - 요청-응답 기반 클라이언트-서버 구조
   - HTTP 클라이언트 (HTTP 요청 메세지)
   - HTTP 서버 (HTTP 응답 메세지)
   * 서버 간에도 HTTP 메세지를 주고받을 수 있음 

- 미디어-독립적
  - 어떤 형태의 데이터도 HTTP 메세지로 보낼 수 있음

- 비연결성
  - 다수의 클라이언트가 연결을 시도할 경우 서버의 자원 소모를 줄이기 위해 비연결성 형태로 동작

- 스테이트리스
  - 클라이언트가 한 서버에 종속될 수 있기 때문에 클라이언트의 상태를 기억하지 않음
  - 서버의 확장성 용이, 장애 대응에 유리

- 지속 연결 (=Keep-Alive)
  - 하나의 연결로 여러 개의 HTTP 요청/응답 주고받기

### HTTP 메세지 개관
HTTP 응답 헤더 - start line
- HTTP/버전 응답 코드 이유 문구(개행)

멱등성(Idempotent) : 여러번의 동일한 요청을 보내도 첫번째의 요청의 결과와 같은 형태
-> POST 메소드는 멱등성이 없다

응답 코드
3XX : 리다이렉션 (해당 요청을 처리하기 위해서는 추가적인 조치가 필요)

### HTTP 헤더
대표적인 헤더 정보
- Host : 요청 호스트에 대한 호스트명 + 포트 정보
- Date : 메시지 생성 시간
- Referer : 직전에 머물렀던 URL
- User-Agent : 클라이언트 소프트웨어, 브라우저 명칭과 정보
- Server : 서버 소프트웨어 명칭과 정보
- Connection : 연결 상태 (Keep-Alive 등)
- Location : 리다이렉트시 이동할 경로

### 캐시
- 서버의 지연을 줄이기 위해 웹 페이지, 이미지 등의 자원 사본을 임시 저장하는 웹 기술

- cache-control 헤더
헤더로 캐시 기능을 알린다
max-age=n(초) : 캐시한 자원의 지속 시간
no-cache : 캐시 가능한 자원이나, 항상 origin 서버에 검증하기
no-store : 캐시하면 안될 자원

- Last-Modigied 헤더 : 마지막 수정 시각 표시

- 캐시된 자원의 변경(1)
1. if-modified-since 특정 시점 이후 자원 변경 여부
2. 변경되었다면 다운로드
3. 변경되지 않았다면 서버는 304 Not Modified 응답
-> "자원이 변경되지 않았으니 캐시로 Redirect 헤라"

- 캐시된 자원의 변경(2)
1. Etag를 통해 자원의 변경 여부 감지
2. 서버는 캐시된 자원에 Etag 식별 문자를 붙인다
3. 클라이언트는 If-None-Match 헤더를 통해 Etag가 변경되었는지 여부를 확인

### 쿠키
- 서버에서 받은 정보를 브라우저에 임시 저장하는 Name=Value 형태의 데이터
- 유효 기간, 도메인과 경로가 존재

- Set-Cookie 헤더
Set-Cookie 헤더를 통해 서버가 쿠키를 전달하면 클라이언트는 저장 후 다음 HTTP 요청의 Cookie 헤더로 활용
  - 도메인 : domain=example.com
    - example.com에 접근할 때 쿠키 활용
  - 경로 : path=/
    - path에 명시된 하위 경로에서 쿠키 활용
  - 유효 기간
    - expires = Wed, 10 Aug 2023 12:00:00 GMT
    - max-age = 1000

- 쿠키 vs 세션
- 저장/관리 주체 
  - 쿠키 : 클라이언트(브라우저)
  - 세션 : 서버

- 쿠키의 보완 기능 (쿠키는 보안에 취약)
  - Secure : HTTPS인 경우에만 전송, 헤더값에 지정
  - HTTPOnly : 자바스크립트에서 접근 불가, XSS 공격 방지

### 컨텐츠 협상 (Content negotiation)
- 클라이언트가 원하는 컨텐츠를 받을 수 있도록 서버에게 부탁하는 기능
- 컨텐츠 타입, 언어, 인코딩 방법 등 클라이언트 맞춤 컨텐츠 제공 기능
- Accept(-X) 헤더 이용
  - Accept : 클라이언트가 선호하는 컨텐츠 타입
  - Accept-Encoding : ~ 인코딩
  - Accept-Language : ~ 언어