# ğŸ³ Jenkins ë¬´ì¤‘ë‹¨ ë°°í¬ + Docker + Bastion + Oracle Cloud (ARM Ampere)

## ğŸ“Œ ëª©í‘œ

- Jenkinsì—ì„œ `develop` ë¸Œëœì¹˜ ê¸°ì¤€ ë¬´ì¤‘ë‹¨ ë°°í¬ êµ¬ì„±
- Oracle Cloud ì¸ìŠ¤í„´ìŠ¤ì— Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì„ Dockerë¡œ ì‹¤í–‰
- Bastion ì„œë²„ë¥¼ ê²½ìœ í•œ íŒŒì¼ ì „ì†¡ (SCP/FileZilla ë“±)
- Swagger UI ê¸°ë°˜ í—¬ìŠ¤ ì²´í¬
- `bootJar`ë¡œ ë¹Œë“œëœ JAR íŒŒì¼ì„ Docker ì´ë¯¸ì§€ë¡œ ì§ì ‘ ë¹Œë“œ ë° ë°°í¬

---

## ğŸ§± ì¸í”„ë¼ êµ¬ì¡°

```text
[Jenkins] 
   â†“ SSH
[Bastion Server]
   â†“ SSH (Private Key)
[Target Oracle Cloud Instance] - app_old (8080) / app_new (8081)
```
â€» ì°¸ê³  ì‚¬í•­
- Bastion ì„œë²„ë¥¼ í†µí•´ì„œë§Œ ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤ ì ‘ê·¼ ê°€ëŠ¥
- ë¬´ì¤‘ë‹¨ ë°°í¬: Port 8080 â†” 8081 ë²ˆê°ˆì•„ ë°°í¬
- Nginx ë˜ëŠ” ë¡œë“œë°¸ëŸ°ì„œì—ì„œ ë‘ í¬íŠ¸ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë°”ë¼ë³´ë„ë¡ êµ¬ì„±



---

## ğŸ› ï¸ Jenkins íŒŒì´í”„ë¼ì¸ êµ¬ì„± (ë¬´ì¤‘ë‹¨ ë°°í¬)
```bash
pipeline {
  environment {
    GIT_CREDENTIALS_ID = 'your-git-credentials-id'
    SSH_CREDENTIALS_ID = 'your-ssh-key'
    TARGET_HOST = 'your-oracle-cloud-instance-public-ip'
    APP_NAME = 'goody-server'
    IMAGE_NAME = 'goody-server'
    DOCKER_REGISTRY = 'your-dockerhub-id/goody-server'
  }

  agent any

  stages {
    stage('Git Clone') {
      steps {
        checkout([$class: 'GitSCM',
          branches: [[name: 'develop']],
          userRemoteConfigs: [[
            url: 'git@github.com:goody-team/goody-server.git',
            credentialsId: "${GIT_CREDENTIALS_ID}"
          ]]
        ])
      }
    }

    stage('Build JAR') {
      steps {
        sh './gradlew clean bootJar'
      }
    }

    stage('Docker Build') {
      steps {
        sh """
        docker build -t ${IMAGE_NAME}:latest -f Dockerfile .
        docker tag ${IMAGE_NAME}:latest ${DOCKER_REGISTRY}:latest
        docker push ${DOCKER_REGISTRY}:latest
        """
      }
    }

    stage('Remote Deploy') {
      steps {
        sshagent([SSH_CREDENTIALS_ID]) {
          sh """
          ssh -o StrictHostKeyChecking=no ubuntu@${TARGET_HOST} '
            bash deploy.sh ${IMAGE_NAME}
          '
          """
        }
      }
    }
  }
}
```

---

## ğŸ”„ ë¬´ì¤‘ë‹¨ ë°°í¬ íë¦„ ì •ë¦¬
1.	Jenkinsì—ì„œ develop ë¸Œëœì¹˜ ê¸°ì¤€ìœ¼ë¡œ Git í´ë¡ 
2.	Gradleë¡œ bootJar ìƒì„±
3.	ìƒì„±ëœ JAR íŒŒì¼ì„ Docker ì´ë¯¸ì§€ë¡œ ë¹Œë“œ í›„ DockerHubë¡œ í‘¸ì‹œ
4.	Bastion ì„œë²„ë¥¼ ê²½ìœ í•˜ì—¬ Oracle Cloud ì¸ìŠ¤í„´ìŠ¤ì— SSH ì ‘ì†
5.	ê¸°ì¡´ ì»¨í…Œì´ë„ˆì™€ í¬íŠ¸ë¥¼ í™•ì¸í•˜ì—¬ ìƒˆë¡œìš´ í¬íŠ¸ë¡œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
6.	Swagger UI /swagger-ui/index.htmlë¡œ í—¬ìŠ¤ ì²´í¬ ìˆ˜í–‰
7.	ì„±ê³µ ì‹œ Nginx í¬íŠ¸ ìŠ¤ìœ„ì¹­ ë˜ëŠ” ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¢…ë£Œ


![2025-07-21 11.26.10.png](resources/2025-07-21%2011.26.10.png)

![2025-07-21 11.26.22.png](resources/2025-07-21%2011.26.22.png)